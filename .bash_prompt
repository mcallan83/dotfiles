# https://github.com/gf3/dotfiles
# https://github.com/cowboy/dotfiles

# if [[ $COLORTERM = gnome-* && $TERM = xterm ]] && infocmp gnome-256color >/dev/null 2>&1; then
	# export TERM=gnome-256color
# elif infocmp xterm-256color >/dev/null 2>&1; then
# 	export TERM=xterm-256color
# fi

# colors
C0="\033[0;30m"
C1="\033[0;31m"
C2="\033[0;32m"
C3="\033[0;33m"
C4="\033[0;34m"
C5="\033[0;35m"
C6="\033[0;36m"
C7="\033[0;37m"

CB0="\033[1;30m"
CB1="\033[1;31m"
CB2="\033[1;32m"
CB3="\033[1;33m"
CB4="\033[1;34m"
CB5="\033[1;35m"
CB6="\033[1;36m"
CB7="\033[1;37m"

RESET="\033[m"

# git status
function prompt_git() {
  local status output flags
  status="$(git status 2>/dev/null)"
  [[ $? != 0 ]] && return;
  output="$(echo "$status" | awk '/# Initial commit/ {print "(init)"}')"
  [[ "$output" ]] || output="$(echo "$status" | awk '/# On branch/ {print $4}')"
  [[ "$output" ]] || output="$(git branch | perl -ne '/^\* (.*)/ && print $1')"
  flags="$(
    echo "$status" | awk 'BEGIN {r=""} \
      /^# Changes to be committed:$/        {r=r "+"}\
      /^# Changes not staged for commit:$/  {r=r "!"}\
      /^# Untracked files:$/                {r=r "?"}\
      END {print r}'
  )"
  if [[ "$flags" ]]; then
    output="$output$flags"
  fi
  echo "[$output]"
}

export PS1="\n\[$C4\]\u\[$C0\]@\[$C4\]\h \[$C2\]\w \[$C1\]\`prompt_git\`\[$RESET\] \[$CB6\]!\!\n\[$CB2\]$\[$RESET\]\[$RESET\] "